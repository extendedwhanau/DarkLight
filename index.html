<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Experience DARKLIGHT, New Zealand's first immersive light exhibition at Brad's Warehouse, Auckland from May 2-4, 2025">
    
    <!-- Social Meta Tags -->
    <meta property="og:title" content="DARKLIGHT â€“ Immersive Light & Sound Exhibition">
    <meta property="og:image" content="https://example.com/path-to-social-image.jpg">
    
    <!-- Fonts & Styles -->
    <link rel="stylesheet" href="https://use.typekit.net/efe5rwd.css">
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.png">
    
    <!-- CMS & Identity -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    
    <title>DARKLIGHT Immersive Light & Sound Exhibition</title>
</head>

<body class="homepage">
    <!-- Logo (Simplified version) -->
     <div class="logo">
        <a href="index.html">
            <img src="images/logo1.svg" alt="DARKLIGHT immersive light and sound exhibition in Auckland" width="100%">
        </a>
    </div>

    <!-- Main Content -->
    <div class="content">
        <h2 id="subtitle">A first-of-its-kind light & sound experience</h2>
        <h1>
            <span id="main-title">A Descent Into Colour</span><br>
            <span id="dates">2-4th May 2025</span><br>
            <span id="location">9/11 Durham Lane, Auckland</span>
        </h1>
        
        <!-- Ticket Container -->
        <div class="ticket-container" id="ticket-container">
            <!-- Ticket buttons will be dynamically inserted here -->
        </div>
    </div>

    <!-- Partners Section -->
    <div id="partners-section">
        <h2>Special thanks</h2>
        <div class="partners-logos">
            <a href="https://www.drinkalmighty.com/" target="_blank"><img src="images/partners/almighty.svg" alt="Almighty"></a>
            <a href="https://www.asahibeverages.co.nz" target="_blank"><img src="images/partners/asahi.svg" alt="Asahi"></a>
            <!-- Add other partner logos -->
        </div>
    </div>

    <!-- Social Icons -->
    <div class="social-icons">
        <a href="https://instagram.com/darklight_experience" target="_blank">
            <img src="images/Instagram.svg" alt="Instagram">
        </a>
        <a href="https://facebook.com/experiencedarklight" target="_blank">
            <img src="images/Facebook.svg" alt="Facebook">
        </a>
    </div>

    <!-- Floating Buttons -->
    <div class="floating-buttons">
        <button><a href="about-darklight.html">About</a></button>
        <button><a href="faq-darklight.html">FAQs</a></button>
        <button><a href="about-resonate.html">Resonate</a></button>
        <button id="partners-btn">Partners</button>
    </div>

    <style>
        .ticket-button.sold-out {
            opacity: 0.7;
            position: relative;
        }
        .ticket-button.sold-out::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #D3D3D3;
            transform: rotate(-10deg);
        }
        .ticket-button.sold-out a {
            pointer-events: none;
            cursor: not-allowed;
        }
    </style>

    <!-- JavaScript -->
    <script>
        // Debug logging function
        function log(message, data) {
            console.log(`[CMS Debug] ${message}:`, data);
        }

        // Netlify Identity
        if (window.netlifyIdentity) {
            log('Netlify Identity Widget loaded');
            window.netlifyIdentity.on("init", user => {
                log('Identity Init', user);
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        } else {
            console.error('[CMS Debug] Netlify Identity Widget not loaded');
        }

        // Load home page content
        async function loadContent() {
            try {
                log('Fetching content from', '/content/home.md');
                const response = await fetch('/content/home.md');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                log('Raw content received', text);
                
                // Split the content at the frontmatter markers
                const parts = text.split('---');
                if (parts.length >= 2) {
                    const yamlContent = parts[1];
                    log('YAML content', yamlContent);
                    
                    const data = jsyaml.load(yamlContent);
                    log('Parsed data', data);
                    
                    // Update page elements with CMS content
                    const updateElement = (id, value) => {
                        const element = document.getElementById(id);
                        if (element && value) {
                            element.textContent = value;
                            element.style.removeProperty('display');
                            log(`Updated ${id}`, value);
                        } else if (element) {
                            element.style.display = 'none';
                            log(`Hiding ${id} due to no content`);
                        }
                    };

                    updateElement('main-title', data.title);
                    updateElement('subtitle', data.subtitle);
                    updateElement('dates', data.dates);
                    updateElement('location', data.location);
                    
                    // Update background image if it exists
                    if (data.background_image) {
                        document.body.style.backgroundImage = `url('${data.background_image}')`;
                        log('Updated background image', data.background_image);
                    }

                    // Update ticket buttons
                    if (data.ticket_buttons && Array.isArray(data.ticket_buttons)) {
                        const container = document.getElementById('ticket-container');
                        if (container) {
                            container.innerHTML = ''; // Clear existing buttons
                            data.ticket_buttons.forEach(button => {
                                // Only create button if it has text and link
                                if (button.text && button.link) {
                                    const buttonHtml = `
                                        <button class="ticket-button${button.sold_out ? ' sold-out' : ''}">
                                            <a href="${button.link}" target="${button.target || '_blank'}">${button.text}</a>
                                        </button>
                                    `;
                                    container.innerHTML += buttonHtml;
                                    log('Added ticket button', button);
                                }
                            });
                            // Hide container if no buttons were added
                            container.style.display = container.innerHTML ? 'flex' : 'none';
                        }
                    }
                    
                    // Handle floating buttons
                    if (data.floating_buttons && Array.isArray(data.floating_buttons)) {
                        const floatingButtons = document.querySelector('.floating-buttons');
                        if (floatingButtons) {
                            floatingButtons.innerHTML = '';
                            let hasButtons = false;
                            data.floating_buttons.forEach(button => {
                                if (button.text && button.link) {
                                    const buttonHtml = `<button><a href="${button.link}">${button.text}</a></button>`;
                                    floatingButtons.innerHTML += buttonHtml;
                                    hasButtons = true;
                                    log('Added floating button', button);
                                }
                            });
                            floatingButtons.style.display = hasButtons ? 'flex' : 'none';
                        }
                    }

                    // Handle social links
                    if (data.social) {
                        const socialIcons = document.querySelector('.social-icons');
                        if (socialIcons) {
                            let hasSocial = false;
                            if (data.social.instagram) {
                                const instagramLink = socialIcons.querySelector('a[href*="instagram"]');
                                if (instagramLink) {
                                    instagramLink.href = data.social.instagram;
                                    instagramLink.style.display = 'flex';
                                    hasSocial = true;
                                }
                            }
                            if (data.social.facebook) {
                                const facebookLink = socialIcons.querySelector('a[href*="facebook"]');
                                if (facebookLink) {
                                    facebookLink.href = data.social.facebook;
                                    facebookLink.style.display = 'flex';
                                    hasSocial = true;
                                }
                            }
                            socialIcons.style.display = hasSocial ? 'flex' : 'none';
                            log('Updated social links visibility', hasSocial);
                        }
                    }
                }
            } catch (err) {
                console.error('[CMS Debug] Error loading content:', err);
                // Try to load the content directly from the file system as fallback
                try {
                    const response = await fetch('content/home.md');
                    const text = await response.text();
                    log('Fallback content loaded', text);
                } catch (fallbackErr) {
                    console.error('[CMS Debug] Fallback also failed:', fallbackErr);
                }
            }
        }

        // Load content when the page loads
        window.addEventListener('DOMContentLoaded', loadContent);

        // Partners Toggle
        document.getElementById('partners-btn').addEventListener('click', function() {
            document.getElementById('partners-section').classList.toggle('active');
        });
    </script>
</body>
</html>