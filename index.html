<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Experience DARKLIGHT, New Zealand's first immersive light exhibition at Brad's Warehouse, Auckland from May 2-4, 2025">
    
    <!-- Social Meta Tags -->
    <meta property="og:title" content="DARKLIGHT â€“ Immersive Light & Sound Exhibition">
    <meta property="og:image" content="https://example.com/path-to-social-image.jpg">
    
    <!-- Fonts & Styles -->
    <link rel="stylesheet" href="https://use.typekit.net/efe5rwd.css">
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.png">
    
    <!-- CMS & Identity -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    
    <title>DARKLIGHT Immersive Light & Sound Exhibition</title>
</head>

<body class="homepage">
    <!-- Logo (Simplified version) -->
     <div class="logo">
        <a href="index.html">
            <img src="images/logo1.svg" alt="DARKLIGHT immersive light and sound exhibition in Auckland" width="100%">
        </a>
    </div>

    <!-- Main Content -->
    <div class="content">
        <h2 id="subtitle">A first-of-its-kind light & sound experience</h2>
        <h1 id="main-title">
            A Descent Into Colour<br>
            <span id="dates">2-4th May 2025</span><br>
            <span id="location">9/11 Durham Lane, Auckland</span>
        </h1>
        
        <div class="ticket-container" id="buttons-container">
            <button class="ticket-button">
                <a href="https://www.iticket.co.nz" target="_blank">Exhibition Tickets</a>
            </button>
            <button class="ticket-button">
                <a href="https://www.undertheradar.co.nz" target="_blank">Resonate Tickets</a>
            </button>
        </div>
    </div>

    <!-- Partners Section -->
    <div id="partners-section">
        <h2>Special thanks</h2>
        <div class="partners-logos">
            <a href="https://www.drinkalmighty.com/" target="_blank"><img src="images/partners/almighty.svg" alt="Almighty"></a>
            <a href="https://www.asahibeverages.co.nz" target="_blank"><img src="images/partners/asahi.svg" alt="Asahi"></a>
            <!-- Add other partner logos -->
        </div>
    </div>

    <!-- Social Icons -->
    <div class="social-icons">
        <a href="https://instagram.com/darklight_experience" target="_blank">
            <img src="images/Instagram.svg" alt="Instagram">
        </a>
        <a href="https://facebook.com/experiencedarklight" target="_blank">
            <img src="images/Facebook.svg" alt="Facebook">
        </a>
    </div>

    <!-- Floating Buttons -->
    <div class="floating-buttons">
        <button><a href="about-darklight.html">About</a></button>
        <button><a href="faq-darklight.html">FAQs</a></button>
        <button><a href="about-resonate.html">Resonate</a></button>
        <button id="partners-btn">Partners</button>
    </div>

    <!-- JavaScript -->
    <script>
        // Debug logging function
        function log(message, data) {
            console.log(`[CMS Debug] ${message}:`, data);
        }

        // Netlify Identity
        if (window.netlifyIdentity) {
            log('Netlify Identity Widget loaded');
            window.netlifyIdentity.on("init", user => {
                log('Identity Init', user);
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        } else {
            console.error('[CMS Debug] Netlify Identity Widget not loaded');
        }

        // Load home page content
        async function loadContent() {
            try {
                log('Fetching content from', '/content/home.md');
                const response = await fetch('/content/home.md');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                log('Raw content received', text);
                
                // Split the content at the frontmatter markers
                const parts = text.split('---');
                if (parts.length >= 2) {
                    const yamlContent = parts[1];
                    log('YAML content', yamlContent);
                    
                    const data = jsyaml.load(yamlContent);
                    log('Parsed data', data);
                    
                    // Update page elements with CMS content
                    if (data.title) {
                        document.getElementById('main-title').innerHTML = data.title;
                        log('Updated title', data.title);
                    }
                    if (data.subtitle) {
                        document.getElementById('subtitle').textContent = data.subtitle;
                        log('Updated subtitle', data.subtitle);
                    }
                    if (data.dates) {
                        document.getElementById('dates').textContent = data.dates;
                        log('Updated dates', data.dates);
                    }
                    if (data.location) {
                        document.getElementById('location').textContent = data.location;
                        log('Updated location', data.location);
                    }
                    
                    // Handle buttons if they exist
                    if (data.buttons && Array.isArray(data.buttons)) {
                        const container = document.getElementById('buttons-container');
                        container.innerHTML = ''; // Clear existing buttons
                        
                        data.buttons.forEach(button => {
                            const buttonHtml = `
                                <button class="ticket-button">
                                    <a href="${button.link}" target="${button.target || '_blank'}">${button.text}</a>
                                </button>
                            `;
                            container.innerHTML += buttonHtml;
                        });
                        log('Updated buttons', data.buttons);
                    }
                    
                    // Handle floating buttons
                    if (data.floating_buttons && Array.isArray(data.floating_buttons)) {
                        const floatingButtons = document.querySelector('.floating-buttons');
                        if (floatingButtons) {
                            floatingButtons.innerHTML = '';
                            data.floating_buttons.forEach(button => {
                                const buttonHtml = `<button><a href="${button.link}">${button.text}</a></button>`;
                                floatingButtons.innerHTML += buttonHtml;
                            });
                            log('Updated floating buttons', data.floating_buttons);
                        }
                    }

                    // Handle social links
                    if (data.social) {
                        const socialIcons = document.querySelector('.social-icons');
                        if (socialIcons && data.social.instagram) {
                            const instagramLink = socialIcons.querySelector('a[href*="instagram"]');
                            if (instagramLink) instagramLink.href = data.social.instagram;
                        }
                        if (socialIcons && data.social.facebook) {
                            const facebookLink = socialIcons.querySelector('a[href*="facebook"]');
                            if (facebookLink) facebookLink.href = data.social.facebook;
                        }
                        log('Updated social links', data.social);
                    }
                }
            } catch (err) {
                console.error('[CMS Debug] Error loading content:', err);
                // Try to load the content directly from the file system as fallback
                try {
                    const response = await fetch('content/home.md');
                    const text = await response.text();
                    log('Fallback content loaded', text);
                } catch (fallbackErr) {
                    console.error('[CMS Debug] Fallback also failed:', fallbackErr);
                }
            }
        }

        // Load content when the page loads
        window.addEventListener('DOMContentLoaded', loadContent);

        // Partners Toggle
        document.getElementById('partners-btn').addEventListener('click', function() {
            document.getElementById('partners-section').classList.toggle('active');
        });
    </script>
</body>
</html>