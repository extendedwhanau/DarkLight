<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.png">
    <title>Installation - DarkLight</title>
    <meta name="description" content="Installation map and details for DarkLight exhibition.">
    <link rel="stylesheet" href="https://use.typekit.net/efe5rwd.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <style>
        /* ===== BASE STYLES ===== */
        html, body {
            background-color: black !important;
            color: #7B7B7B;
            scroll-behavior: smooth;
            overflow-x: hidden !important;
            overflow-y: auto !important;
            height: auto !important;
            min-height: auto !important;
        }

        .logo {
            width: 100%;
            padding: 15px 0 0 0;
            text-align: center;
        }

        /* ===== LAYOUT ===== */
        .installation-merged-layout {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            width: 100%;
            height: auto;
            min-height: 100vh;
            overflow: visible;
            padding: 24px;
        }

        /* ===== LEFT SIDE ===== */
        .installation-left-side {
            width: 50%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .installation-image-container {
            width: 95%;
            max-width: 600px;
            margin: 40px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .installation-image {
            width: 100%;
            height: auto;
            object-fit: contain;
        }

        /* ===== NAVIGATION ===== */
        .installation-merged-nav {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 40px 0 0 0;
            position: sticky;
            top: 25rem;
            z-index: 10;
            height: fit-content;
        }

        .installation-merged-nav a {
            color: #D3D3D3;
            text-decoration: none;
            font-size: 18px;
            font-weight: 400;
            line-height: 23px;
            letter-spacing: 2px;
            margin-bottom: 30px;
            padding: 0;
            text-align: left;
            transition: color 0.1s;
            display: block;
        }

        .installation-merged-nav a.active, 
        .installation-merged-nav a:hover {
            color: #D3D3D3;
        }

        /* ===== RIGHT SIDE ===== */
        .installation-merged-content {
            width: 50%;
            padding: 40px 0 40px 40px;
            height: auto;
            overflow: visible;
        }

        /* ===== CONTENT SECTIONS ===== */
        .installation-merged-content section {
            margin-bottom: 20vh;
            padding-top: 48px;
            padding-bottom: 40px;
        }

        .installation-merged-content section:last-child {
            margin-bottom: 0;
        }

        .content-section {
            margin-bottom: 2rem;
        }

        .content-section h1, 
        .content-section h2, 
        .content-section h3, 
        .content-section h4, 
        .content-section h5, 
        .content-section h6 {
            color: #D3D3D3;
            font-size: 18px;
            margin-bottom: 18px;
            letter-spacing: 2px;
            text-align: left;
        }

        .content-section p {
            margin-bottom: 18px;
        }

        .content-section a {
            color: inherit;
            text-decoration: underline;
            text-underline-offset: 5px;
        }

        .content-section strong, 
        .content-section b, 
        .content-section span {
            font-weight: 400 !important;
            color: #D3D3D3 !important;
        }

        /* ===== ARTWORK STYLES ===== */
        .artwork-header {
            margin-bottom: 30px;
        }

        .artwork-title {
            color: #D3D3D3;
            font-size: 24px;
            font-weight: 400;
            line-height: 1.2;
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-align: left;
        }

        .artwork-details {
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        .artwork-detail {
            color: #7B7B7B;
            font-size: 18px;
            font-weight: 400;
            line-height: 23px;
            letter-spacing: 2px;
        }

        .artwork-detail strong {
            color: #D3D3D3;
            font-weight: 400;
        }

        .artwork-bio {
            color: #7B7B7B;
            font-size: 18px;
            font-weight: 400;
            line-height: 23px;
            letter-spacing: 2px;
            text-align: left;
            margin-top: 30px;
      
        }

        .artwork-bio strong, 
        .artwork-bio b, 
        .artwork-bio span {
            font-weight: 400 !important;
            color: #D3D3D3 !important;
        }

        .artwork-content {
            color: #7B7B7B;
            font-size: 18px;
            font-weight: 400;
            line-height: 23px;
            letter-spacing: 2px;
            text-align: left;
            margin-top: 30px;
        }

        .artwork-content strong, 
        .artwork-content b {
            font-weight: 600 !important;
            color: #D3D3D3 !important;
        }
        .artwork-content em, 
        .artwork-content i {
            font-style: italic !important;
            color: #D3D3D3 !important;
        }
        
        /* Make artist names white while keeping labels grey */
        .artwork-content em.label,
        .artwork-content .label {
            color: #7B7B7B !important;
            font-style: italic !important;
        }
        
        .artwork-content span.name,
        .artwork-content .name {
            color: #D3D3D3 !important;
        }
        .artwork-content span {
            font-weight: 400 !important;
            color: #D3D3D3 !important;
        }
        .artwork-content a {
            color: inherit;
            text-decoration: underline;
            text-underline-offset: 5px;
        }

        .artwork-section {
            margin-bottom: 90px;
            padding-bottom: 90px;
            border-bottom: 1px solid #333;
        }

        .artwork-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        /* ===== MOBILE RESPONSIVE ===== */
        @media (max-width: 900px) {
            .installation-merged-layout {
                flex-direction: column;
                padding: 0 20px 10vh 20px;
            }

            .installation-left-side {
                width: 100%;
                padding: 20px 0;
                text-align: center;
            }

            .installation-image-container {
                width: 100%;
                max-width: 550px;
                margin: 20px auto 30px auto;
            }

            .installation-merged-nav {
                width: 100%;
                padding: 0;
                position: static;
                text-align: left;
                align-items: flex-start;
                gap: 0;
            }

            .installation-merged-nav a,
            .installation-merged-nav a:visited,
            .installation-merged-nav a:active,
            .installation-merged-nav a:focus,
            .installation-merged-nav a:hover {
                text-align: left !important;
                margin: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: flex-start !important;
                width: 100% !important;
                max-width: 280px !important;
                padding: 0 !important;
                text-decoration: none !important;
                color: #7B7B7B !important;
                transition: color 0.3s ease !important;
                background-color: transparent !important;
                border: none !important;
                outline: none !important;
                box-sizing: border-box !important;
                font-size: 18px !important;
                font-weight: 400 !important;
                line-height: 23px !important;
                letter-spacing: 2px !important;
                cursor: pointer !important;
            }

            .installation-merged-nav a:hover,
            .installation-merged-nav a.active {
                color: #ffffff !important;
                background-color: transparent !important;
                transform: none !important;
                scale: 1 !important;
            }

            .installation-merged-content {
                width: 100%;
                padding: 20px 0;
            }

            .artwork-title {
                font-size: 20px;
            }

            .artwork-detail {
                font-size: 16px;
            }

            .artwork-bio {
                font-size: 16px;
            }
        }
    </style>
</head>
<body class="installation-page">
    <div class="logo">
        <a href="index.html">
            <img src="images/motif.svg" alt="DARKLIGHT immersive light and sound exhibition in Auckland" width="20%">
        </a>
    </div>
    
    <div class="installation-merged-layout">
        <div class="installation-left-side">
            <div class="installation-image-container" id="image-container">
                <!-- Image will be loaded dynamically -->
            </div>
            <nav class="installation-merged-nav custom-nav" id="navigation">
                <!-- Navigation will be loaded dynamically -->
            </nav>
        </div>
        <main class="installation-merged-content" id="content">
            <!-- Content will be loaded dynamically -->
            <div class="loading">Loading content...</div>
        </main>
    </div>

    <script>
    // Load installation page content
    async function loadInstallationContent() {
        try {
            const contentElement = document.getElementById('content');
            const navigationElement = document.getElementById('navigation');
            contentElement.innerHTML = '';
            navigationElement.innerHTML = '';
            
            const response = await fetch('/content/installation.md');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const text = await response.text();
            
            // Split the content at the frontmatter markers
            const parts = text.split('---');
            if (parts.length >= 2) {
                const yamlContent = parts[1];
                const data = jsyaml.load(yamlContent);
                
                // Render the installation page content
                renderInstallationPage(data);
            }
        } catch (err) {
            console.error('Failed to load installation content:', err);
            document.getElementById('content').innerHTML = `
                <section id="installation-main">
                    <div class="section-title">Installation</div>
                    <div class="content-section">
                        <p>Failed to load content. Please refresh the page.</p>
                    </div>
                </section>
            `;
        }
    }

    function renderInstallationPage(data) {
        // Render navigation
        const navigation = document.getElementById('navigation');
        if (data.visible !== false && data.artworks && data.artworks.length > 0) {
            const navHTML = data.artworks.map(artwork => `
                <a href="#artwork-${artwork.number}" id="nav-artwork-${artwork.number}">
                    <span class="nav-num">${artwork.number}&nbsp;&nbsp;&nbsp;&nbsp;</span> 
                    <span class="nav-label">${artwork.name}</span>
                </a>
            `).join('');

            navigation.innerHTML = navHTML;
        }



        // Render image (in left side)
        const imageContainer = document.getElementById('image-container');
        if (data.image && data.visible !== false) {
            imageContainer.innerHTML = `
                <img src="${data.image}" alt="Installation Map" class="installation-image">
            `;
        } else if (data.visible === false) {
            imageContainer.innerHTML = '';
        }

        // Render content
        const content = document.getElementById('content');
        if (data.visible !== false && data.artworks && data.artworks.length > 0) {
            const artworksHTML = data.artworks.map(artwork => {
                return `
                    <div class="artwork-section" id="artwork-${artwork.number}">
                        <div class="artwork-header">
                            <h1 class="artwork-title">${artwork.number}&nbsp;&nbsp;&nbsp;&nbsp;${artwork.name}</h1>
                        </div>
                        <div class="artwork-content">
                            ${convertMarkdownToHtml(artwork.content || 'Content coming soon...')}
                        </div>
                    </div>
                `;
            }).join('');

            content.innerHTML = `
                <section id="installation-main">
                    <div class="content-section">
                        ${artworksHTML}
                    </div>
                </section>
            `;
        } else if (data.visible === false) {
            content.innerHTML = `
                <section id="installation-main">
                    <div class="section-title">Installation</div>
                    <div class="content-section">
                        <p>This page is currently not available.</p>
                    </div>
                </section>
            `;
        } else {
            content.innerHTML = `
                <section id="installation-main">
                    <div class="section-title">Installation</div>
                    <div class="content-section">
                        <p>No artworks available.</p>
                    </div>
                </section>
            `;
        }

        // Initialize navigation active state
        initializeNavigation();
    }

    function convertMarkdownToHtml(markdown) {
        if (!markdown) return '';
        
        let html = markdown
            // Remove backslashes that CMS adds for line breaks
            .replace(/\\\n/g, '\n')
            .replace(/\\/g, '')
            // Convert markdown to HTML
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
            // Handle line breaks properly - more sophisticated approach
            .split(/\n\n+/)
            .map(paragraph => {
                if (paragraph.trim() === '') return '';
                return '<p>' + paragraph.trim().replace(/\n/g, '<br>') + '</p>';
            })
            .filter(p => p !== '')
            .join('');
        
        // First, handle any italic text ending with colon (make them labels)
        html = html.replace(/(<em>([^<]*?):<\/em>)/g, '<em class="label">$2:</em>');
        // Then handle italic labels with names
        html = html.replace(/(<em class="label">([^<]*?):<\/em>)\s*([^<\n]+)/g, '<em class="label">$2:</em> <span class="name">$3</span>');
        // Also handle non-italic labels - more comprehensive
        html = html.replace(/(Artist|Sound Design|Mixdown|Fabrication|Animation Design):\s*([^<\n\r]+)/g, '<em class="label">$1:</em> <span class="name">$2</span>');
        
        return html;
    }

    function initializeNavigation() {
        // Throttle scroll events for better performance
        let ticking = false;
        
        function setActiveNav() {
            if (!ticking) {
                requestAnimationFrame(() => {
                    const sections = document.querySelectorAll('section[id]');
                    let found = false;
                    
                    sections.forEach(section => {
                        const sectionId = section.id;
                        const navLink = document.getElementById('nav-' + sectionId.replace('installation-', ''));
                        
                        if (navLink && window.scrollY + 100 >= section.offsetTop) {
                            document.querySelectorAll('.installation-merged-nav a').forEach(a => a.classList.remove('active'));
                            navLink.classList.add('active');
                            found = true;
                        }
                    });
                    
                    if (!found) {
                        document.querySelectorAll('.installation-merged-nav a').forEach(a => a.classList.remove('active'));
                    }
                    
                    ticking = false;
                });
                ticking = true;
            }
        }

        window.addEventListener('scroll', setActiveNav, { passive: true });
        window.addEventListener('DOMContentLoaded', setActiveNav);
    }

    // Load content immediately for faster perceived loading
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadInstallationContent);
    } else {
        loadInstallationContent();
    }
    </script>
</body>
</html>
